<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Comments</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* --- Your Original CSS (unchanged) --- */
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Montserrat',sans-serif;background:#0F1A2B;color:#D1CFC9;display:flex;flex-direction:column;min-height:100vh;}
    .box{background:#192c44;border-radius:12px;padding:20px;}
    .comment-card{min-width:100%;padding:20px;background:#2D394C;border-radius:12px;margin:0 10px;}
  </style>
</head>
<body>

<header>
  <div class="logo"><a href="index.html"><img src="samvaadsetu.jpg" alt="Logo"></a></div>
  <div class="header-title">All Comments</div>
  <div class="hamburger-menu" onclick="openNav()">☰</div>
</header>

<div id="mySidebar" class="sidebar">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
  <a href="i.html">Home</a>
  <a href="about.html">Contact Us</a>
  <a href="https://www.mca.gov.in/content/mca/global/en/home.html" target="_blank">MOCA</a>
  <a href="policy.html">Policy</a>
</div>

<div class="main-container">
  <div class="box summary-box">
    <h2>Overall Summary</h2>
    <textarea id="overallSummary" style="width:100%;height:150px;background:#2D394C;color:#D1CFC9;"></textarea>
  </div>

  <div class="box chart-box">
    <h2>Sentiment Distribution</h2>
    <canvas id="sentimentPieChart"></canvas>
  </div>

  <div class="box comments-box full-width">
    <h2>All User Comments</h2>
    <div id="commentCarousel" style="display:flex;overflow:hidden;width:100%;justify-content:center;">
      <div class="carousel-track" id="commentTrack" style="display:flex;transition:transform 0.5s ease;"></div>
    </div>
  </div>

  <div class="box full-width" style="display:flex;flex-wrap:wrap;gap:20px;">
    <div style="flex:1 1 48%;background:#192c44;border-radius:12px;padding:20px;">
      <h2>Word Cloud</h2>
      <img id="wordcloudImg" style="max-width:100%;border-radius:8px;">
    </div>
    <div style="flex:1 1 48%;background:#192c44;border-radius:12px;padding:20px;">
      <h2>Most Frequent Keywords</h2>
      <ul id="keywordsList" style="list-style:none;padding-left:0;"></ul>
    </div>
  </div>
</div>

<script>
async function loadData(){
  const params=new URLSearchParams(window.location.search);
  const table=params.get("table");
  if(!table)return;

  const res=await fetch("http://localhost:5000/comments/"+table);
  const data=await res.json();
  const comments=data.comments.map(c=>c.suggestion);

  const res2=await fetch("http://localhost:5000/analyze",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({comments})});
  const analysis=await res2.json();

  document.getElementById("overallSummary").value=analysis.results.map(r=>r.summary).join(" ");

  const pos=analysis.results.filter(r=>r.sentiment==="Positive").length;
  const neg=analysis.results.filter(r=>r.sentiment==="Negative").length;
  const neu=analysis.results.filter(r=>r.sentiment==="Neutral").length;
  new Chart(document.getElementById("sentimentPieChart"),{type:'doughnut',data:{labels:['Positive','Negative','Neutral'],datasets:[{data:[pos,neg,neu],backgroundColor:['#28a745','#dc3545','#ffc107']}]}});

  document.getElementById("wordcloudImg").src="data:image/png;base64,"+analysis.wordcloud;

  const freq={};
  comments.join(" ").toLowerCase().split(/\s+/).forEach(w=>{if(w.length>3)freq[w]=(freq[w]||0)+1;});
  const top=Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const list=document.getElementById("keywordsList");list.innerHTML="";
  top.forEach(([k,v])=>{const li=document.createElement("li");li.textContent=• ${k} (${v});list.appendChild(li);});

  const track=document.getElementById("commentTrack");
  track.innerHTML="";
  data.comments.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="comment-card";
    div.innerHTML=<h3>Comment ${c.id}</h3><p>${c.suggestion}</p><p><b>Summary:</b> ${analysis.results[i].summary}</p><p><b>Sentiment:</b> ${analysis.results[i].sentiment}</p>;
    track.appendChild(div);
  });
}
loadData();

function openNav(){document.getElementById("mySidebar").style.width="250px";}
function closeNav(){document.getElementById("mySidebar").style.width="0";}
</script>
</body>
</html>
